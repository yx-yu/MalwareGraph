# -*- coding=utf-8 -*-

root = "../DataSet/2Trojan"
out_root = "./Priv_img/"
import sys
import os
from math import log
import numpy as np
import scipy as sp
from PIL import Image
import matplotlib.pyplot as plt


# This function all ows us to process our hexadecimal files into png images##
def convertandsave(array, name):
    print('Processing ' + name)
    if array.shape[1] != 16:  # If not hexadecimal
        assert False
    b = int((array.shape[0] * 16) ** 0.5)
    b = 2 ** (int(log(b) / log(2)))
    a = int(array.shape[0] * 16 / b)
    array = array[:a * b // 16, :]
    array = np.reshape(array, (a, b))
    im = Image.fromarray(np.uint8(array))
    im.save(out_root + name + '.png', "PNG")
    return im


# Get the list of files
files = os.listdir(root)
print('files : ', files)
# We will process files one by one.
for counter, name in enumerate(files):
    # We only process .bytes files from our folder.
    if '.bytes' != name[-6:]:
        continue
    f = open(root + '/' + name, encoding='utf-8')
    array = []
    for line in f:
        xx = line.split()
        if len(xx) != 16:
            continue
        array.append([int(i, 16) if i != '??' else 0 for i in xx[0:]])
    plt.imshow(convertandsave(np.array(array), name))
    del array
    f.close()
